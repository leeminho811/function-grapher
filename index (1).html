  <script>
    let allTraces = [];

    function insertText(text) {
      const input = document.getElementById("functionInput");
      const start = input.selectionStart;
      const end = input.selectionEnd;
      input.value = input.value.substring(0, start) + text + input.value.substring(end);
      input.focus();
      input.selectionStart = input.selectionEnd = start + text.length;
    }

    function clearInput() {
      document.getElementById("functionInput").value = "";
    }

    function clearPlot() {
      allTraces = [];
      Plotly.newPlot("plot", []);
    }

    function getRandomColor() {
      const colors = ["red", "blue", "green", "purple", "orange", "brown", "magenta"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function getRandomDash() {
      const styles = ["solid", "dot", "dash", "longdash", "dashdot"];
      return styles[Math.floor(Math.random() * styles.length)];
    }

    function draw() {
      const expr = document.getElementById("functionInput").value;
      if (!expr) {
        alert("함수를 입력하세요!");
        return;
      }

      const xValues = Array.from({ length: 200 }, (_, i) => -10 + i * 0.1);
      let yValues;

      try {
        const compiled = math.compile(expr);
        yValues = xValues.map(x => compiled.evaluate({ x }));
      } catch (err) {
        alert("함수 해석 오류: " + err.message);
        return;
      }

      const trace = {
        x: xValues,
        y: yValues,
        mode: "lines",
        type: "scatter",
        name: expr,
        line: {
          color: getRandomColor(),
          dash: getRandomDash(),
          width: 2
        }
      };

      allTraces.push(trace);
      Plotly.newPlot("plot", allTraces, { margin: { t: 20 } });
    }
  </script>
